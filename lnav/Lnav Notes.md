---
author: Liu Xiang
title: Lnav 日志查看器使用笔记
---

# Lnav 日志查看器使用笔记

## 📖 基础操作

### 启动和帮助
- **不加参数启动**：查看系统日志
- **调出帮助**：按 `?` 键

### 页面导航
- **下一页/上一页**：`SPC` / `b`
- **按天移动**：`d` / `D` (向前/向后)
- **按小时移动**：`6` / `^` (移动到整点)
- **按分钟移动**：`7` / `8` (移动到分钟开头)
- **按10分钟间隔移动**：
  - `1` / `!` (10分处)
  - `2` / `@` (20分处)
  - `3` / `#` (30分处)
  - `4` / `$` (40分处)
  - `5` / `%` (50分处)

## 🔍 搜索功能

### 文本搜索
1. **开始搜索**：按斜杠 `/` 键
2. **下一个/上一个匹配**：`n` / `N`

## 🎯 过滤功能

### 过滤器设置
1. **进入过滤器设置**：按 `TAB` 键，切换到过滤器设置
2. **选择过滤器类型**：按 `TAB` 选定 `Text Filters`
3. **添加过滤器**：按 `i` 键，输入过滤条件，按回车确认
4. **删除过滤器**：按 `d` 键
5. **退出过滤器设置**：按 `q` 键

**注意**：退出过滤器设置后，如果存在过滤器，只会显示匹配过滤条件的行。

## 📱 显示控制

### 视图切换
- **切换行换行**：`Ctrl-w`
- **查看原始文本**：`Ctrl-l` (可用于鼠标选区并复制)
- **切换美化视图**：`P`
- **直方图视图**：`i`
- **直方图缩放**：`z` / `Z` (放大/缩小)
- **切换日志视图/SQL结果视图**：`v`

### 字段显示控制
- **启用/禁用字段显示**：`p` 键
- **临时显示字段**：按分号 `;` 键 (便于编写查询)

## 📝 标记和复制

### 行标记
- **标记/取消标记当前行**：`m`
- **标记/取消标记范围**：`M` (标记从顶部显示到上次标记行之间的所有行)
- **标记下一行/上一行**：`J` / `K`

### 复制操作
- **复制标记的行**：`c`
- **清除所有标记**：`C`

## 📁 文件管理

### 多文件操作
- **关闭当前日志文件**：`X`
- **恢复之前的视图**：`a` / `A`
- **移动到下一个/上一个文件**：`f` / `F`

### 文件格式支持
- **压缩文件**：可以直接查看 gzip 压缩后的日志
- **多文件查看**：可以同时查看多个日志文件

## 🗄️ SQL 查询功能

### 执行查询
- **执行 SQL 查询**：按分号 `;` 键

### 常用查询示例
```sql
-- 查询所有日志
SELECT * FROM logline

-- 查询 Rails 日志
SELECT * FROM rails_log
```

### 可用列说明
所有日志表至少包含以下列：

| 列名 | 说明 |
|------|------|
| `log_line` | 文件中的行号（从0开始） |
| `log_part` | 分区名称，可使用 UPDATE 语句或 'partition-name' 命令修改 |
| `log_time` | 日志条目时间 |
| `log_idlemsecs` | 当前日志消息与上一条之间的时间间隔（毫秒） |
| `log_level` | 日志级别（如 info、error 等） |
| `log_mark` | 书签状态，可使用 UPDATE 查询写入 |
| `log_path` | 文件的完整路径 |
| `log_text` | 原始文本行（注意：'select *' 结果中不包含此列，但确实存在） |

## 💡 高级技巧

### 按当前行的 trace_id 过滤
```lnav
:filter-expr :trace_id = (select trace_id from java_log where log_line = log_top_line())
```

### 写入文件
- **写入标记行到文件**：`:write-to <文件名>`
<<<<<<< HEAD
- **写入到终端**：`:write-to -`
=======
- **写入到终端**：`:write-to -`

### 只输出错误日志

```shell
lnav -n -c ':set-min-log-level ERROR' .
```


### 只输出下午 2 点到下午 3 点的日志

```shell
lnav -n -c ':hide-lines-before 2pm' -c ':hide-lines-after 3pm' .
```


### `body` (`content`) 的字段名为 `log_body`

```sql
select log_body from java_log
```